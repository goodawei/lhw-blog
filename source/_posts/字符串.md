---
title: 字符串和字符编码原理
date: 2017-02-24 20:56:53
tags: 字符串
categories: php
---

### :spider:单引号和双引号的区别

单引号和双引号的区别经常被当做面试题被问到，但是大部分回答的并不好，其中有以下几种区别经常被忽略。
当字符串用双引号或者heredoc结构定义时，其中变量可以被解析，同时可以解析以下字符

- \n,\r,\t,\v,\e,\f,\\,\$,\"
- \[0-7]{1,3}符合该正则表达式的，是以一个八进制方式来表达的字符，例如
```php
    /**
    * 101转10进制：1*8^2+0*8^1+1*8^0 = 64+0+1 = 65
    * 102转10进制：1*8^2+0*8^1+2*8^0 = 64+0+2 = 66
    */
    echo "\101\102" // AB
```
- \x[0-9A-Fa-f]{1,2}符合该正则表达的，是以一个十六进制方式来表达的字符，例如

```php
    /**
    * 41转10进制：4*16^1+1*16^0 = 64+1 = 65
    * 42转10进制：4*16^2+2*16^0 = 64+2 = 66
    */
    echo "\x41\x42" // AB
```

> 单引号只转义\\ 和 \'

### :arrow_lower_right: 关于字符串下标

- 获取字符串中的字符，可以通过下标去获取。
- 用超出字符串长度的下标写入字符串，会拉长该字符串，中间以空格填充。
```php
$str = 'lhw';
$str[10] = 'ok';
echo $str;
```

### :ant: 字符串串行化

串行化的目的：将不易于存储的数据结构，通过串行化来存储数据库或者文件当中。

- serialize()   性能稍差，可序列号对象
- json_encode() 性能好，这序列化数组，并且不同语言可通用
- var_export($arr,true) 序列化数组，并写入文件，可做文件缓存使用，或者写入日志调试

> var_export 利用它的特性，可以将读取数据库的配置等信息，写入缓存文件。

<!-- more -->

### 字符

相关关键字

- 位(bit b)，计算机最小存储单位，0或1组成
- 字节(byte B),计量单位
- 字符(char),可见字母，数字，符号等

### 字符集和字符编码

- 字符集
所有抽象字符的集合，如 ASCII 字符集，Unicode 字符集
- 字符编码
一种约定规范，使字符和计算机直接建立对应关系，就是以二进制的数字对应字符集的字符。


### ASCII 编码

美国定义的字符集，只用一个字节标识的字符，使用字节的低7位标识一共2的7次方128个字符，这些字符都和二进制数字有了对应关系。

### Latin1 编码 (ISO-8859-1)

在ASCII编码基础上的扩展，主要是西欧国家的，范围是125-255(具体字符去 google)

### GB2132编码 和 GBK编码 (中国)

- GB2132 只收了常用的6763个汉字
- GBK在GB2132的基础上扩展了许多行的汉字
    
GB2132一个汉字用2个字节表示，一个字节占8位总共分为2的8次方(`256`)种可能，两个字节就是`256*256=65536`种不同的符合，但是中国只才用了两个字节的低7位`128*128=16384`种不同的汉字。但是在GB2132中为了和ASCII保持兼容，GB2132的每个字节中不能在用ASCII中的字符编码，所有实际GB2132所能表示的只有94*94=8836个。

### BIG5编码 (台湾)

### ISO组织的Unicode字符集
- Unicode的编码方式：UTF-8/UTF-16/UTF-32
- Unicode 采用4个字节来表达一个字符

### UTF-8的编码规则

Unicode编码(16进制)  | UTF-8字节流(二进制)
-----------         |--------------------
0000-007F           | 0xxxxxxx
0080-07FF           | 110xxxxx 10xxxxxx
0800-FFFF           | 1110xxxx 10xxxxxx 10xxxxxx
010000-10FFFF       | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx

中国的汉字范围是4E00-9FFF,根据上面的规则可以看出，是0800-FFFF区间，所以UTF-8的汉字是3个字节。

如何把'北京'的unicode码 '21271','20140'转为UTF-8.

- 算出每个字的二进制
- 从右至左一次填充，不足补0： 1110xxxx 10xxxxxx 10xxxxxx
- 在将二进制转为16进制
- 将16进制编辑到编辑器，已UTF-8查看

### UTF-16的编码规则

和 UTF-8类似，采用两个字节存储一个字符，但是不兼容ASCII码，如果存储英文势必会造成空间的浪费

### GBK和UTF-8如何选择

- 优先选择UTF-8
- 为了节省存储空间选择GBK
- 支持多种语言选择UTF-8

PHP 中的`json_encode()`是只支持UTF-8的汉字。